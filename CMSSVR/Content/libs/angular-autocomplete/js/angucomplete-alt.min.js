"use strict";(function(n,t){typeof module!="undefined"&&module.exports?module.exports=t(require("angular")):typeof define=="function"&&define.amd?define(["angular"],t):t(n.angular)})(window,function(n){n.module("angucomplete-alt",[]).directive("angucompleteAlt",["$q","$parse","$http","$sce","$timeout","$templateCache","$interpolate",function(n,t,i,r,u,f,e){function tt(t,f,e,l){function ii(n,i){n&&(typeof n=="object"?(t.searchStr=vt(n),ht({originalObject:n})):typeof n=="string"&&n.length>0?t.searchStr=n:console&&console.error&&console.error("Tried to set "+(!i?"":"initial")+" value of angucomplete to",n,"which is an invalid value"),ut(!0))}function ri(n){rt=null;t.hideResults(n);document.body.removeEventListener("click",ri)}function ui(n){return n.which?n.which:n.keyCode}function ht(n){typeof t.selectedObject=="function"?t.selectedObject(n):t.selectedObject=n;n?ut(!0):ut(!1)}function wi(n){return function(i){return t[n]?t[n](i):i}}function bi(n){ht({originalObject:n});t.clearSelected&&(t.searchStr=null);et()}function vt(n){return t.titleField.split(",").map(function(t){return st(n,t)}).join(" ")}function st(n,t){var u,i,r;if(t)for(u=t.split("."),i=n,r=0;r<u.length;r++)i=i[u[r]];else i=n;return i}function fi(n,i){var e,u,f;if(f=new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),n)return n.match&&n.replace||(n=n.toString()),u=n.match(f),e=u?n.replace(f,'<span class="'+t.matchClass+'">'+u[0]+"<\/span>"):n,r.trustAsHtml(e)}function ut(n){t.notEmpty=n;at=t.searchStr;t.fieldRequired&&l&&t.inputName&&l[t.inputName].$setValidity(wt,n)}function ki(n){var i=ui(n);if(i!==v&&i!==a)if(i===s||i===c)n.preventDefault();else if(i===o)n.preventDefault(),!t.showDropdown&&t.searchStr&&t.searchStr.length>=it&&(vi(),t.searching=!0,yi(t.searchStr));else if(i===h)et(),t.$apply(function(){ft.val(t.searchStr)});else{if(it===0&&!t.searchStr)return;t.searchStr&&t.searchStr!==""?t.searchStr.length>=it&&(vi(),lt&&u.cancel(lt),t.searching=!0,lt=u(function(){yi(t.searchStr)},t.pause)):t.showDropdown=!1;at&&at!==t.searchStr&&!t.clearSelected&&t.$apply(function(){ht()})}}function yt(n){!t.overrideSuggestions||t.selectedObject&&t.selectedObject.originalObject===t.searchStr||(n&&n.preventDefault(),u.cancel(lt),ct(),bi(t.searchStr))}function di(n){var t=getComputedStyle(n);return n.offsetHeight+parseInt(t.marginTop,10)+parseInt(t.marginBottom,10)}function gi(){return tt.getBoundingClientRect().top+parseInt(getComputedStyle(tt).maxHeight,10)}function ei(){return f[0].querySelectorAll(".angucomplete-row")[t.currentIndex]}function nr(){return ei().getBoundingClientRect().top-(tt.getBoundingClientRect().top+parseInt(getComputedStyle(tt).paddingTop,10))}function oi(n){tt.scrollTop=tt.scrollTop+n}function si(){var n=t.results[t.currentIndex];t.matchClass?ft.val(vt(n.originalObject)):ft.val(n.title)}function tr(n){var i=ui(n),r=null,u=null;i===c&&t.results?(t.currentIndex>=0&&t.currentIndex<t.results.length?(n.preventDefault(),t.selectResult(t.results[t.currentIndex])):(yt(n),et()),t.$apply()):i===o&&t.results?(n.preventDefault(),t.currentIndex+1<t.results.length&&t.showDropdown&&(t.$apply(function(){t.currentIndex++;si()}),bt&&(r=ei(),gi()<r.getBoundingClientRect().bottom&&oi(di(r))))):i===s&&t.results?(n.preventDefault(),t.currentIndex>=1?(t.$apply(function(){t.currentIndex--;si()}),bt&&(u=nr(),u<0&&oi(u-1))):t.currentIndex===0&&t.$apply(function(){t.currentIndex=-1;ft.val(t.searchStr)})):i===y?t.results&&t.results.length>0&&t.showDropdown?t.currentIndex===-1&&t.overrideSuggestions?yt():(t.currentIndex===-1&&(t.currentIndex=0),t.selectResult(t.results[t.currentIndex]),t.$digest()):t.searchStr&&t.searchStr.length>0&&yt():i===h&&n.preventDefault()}function hi(n){return function(i,r,u,f){r||u||f||!i.data||(i=i.data);t.searching=!1;kt(st(dt(i),t.remoteUrlDataField),n)}}function ci(n,i,r,u){i!==0&&i!==-1&&(i||r||u||(i=n.status),t.remoteUrlErrorCallback?t.remoteUrlErrorCallback(n,i,r,u):console&&console.error&&console.error("http error"))}function ct(){ot&&ot.resolve()}function li(r){var u={},f=t.remoteUrl+encodeURIComponent(r);t.remoteUrlRequestFormatter&&(u={params:t.remoteUrlRequestFormatter(r)},f=t.remoteUrl);!t.remoteUrlRequestWithCredentials||(u.withCredentials=!0);ct();ot=n.defer();u.timeout=ot.promise;i.get(f,u).success(hi(r)).error(ci)}function ai(i){ct();ot=n.defer();t.remoteApiHandler(i,ot.promise).then(hi(i)).catch(ci)}function et(){t.showDropdown=!1;t.results=[];tt&&(tt.scrollTop=0)}function vi(){t.showDropdown=ni;t.currentIndex=t.focusFirst?0:-1;t.results=[]}function ir(n){for(var r,u,e,o=t.searchFields.split(","),f=[],i=0;i<t.localData.length;i++){for(r=!1,u=0;u<o.length;u++)e=st(t.localData[i],o[u])||"",r=r||e.toString().toLowerCase().indexOf(n.toString().toLowerCase())>=0;r&&(f[f.length]=t.localData[i])}t.searching=!1;kt(f,n)}function rr(n,i,r){if(!r)return!1;for(var u in i)if(i[u].toLowerCase()===r.toLowerCase())return t.selectResult(n),!0;return!1}function yi(n){!n||n.length<it||n.length>t.maxlength||(t.localData?t.$apply(function(){ir(n)}):t.remoteApiHandler?ai(n):li(n))}function kt(n,i){var r,u,f,e,o,s;if(n&&n.length>0)for(t.results=[],r=0;r<n.length;r++)t.titleField&&t.titleField!==""&&(e=o=vt(n[r])),u="",t.descriptionField&&(u=s=st(n[r],t.descriptionField)),f="",t.imageField&&(f=st(n[r],t.imageField)),t.matchClass&&(o=fi(e,i),s=fi(u,i)),t.results[t.results.length]={title:o,description:s,image:f,originalObject:n[r]};else t.results=[];t.showDropdown=t.autoMatch&&t.results.length===1&&rr(t.results[0],{title:e,desc:u||""},t.searchStr)?!1:t.results.length!==0||ti?!0:!1}function pi(){t.localData?kt(t.localData,""):t.remoteApiHandler?ai(""):li("")}var ft=f.find("input"),it=p,lt=null,pt,wt=d,dt,at=null,ot=null,tt=f[0].querySelector(".angucomplete-dropdown"),bt=!1,rt=null,gt,ni,ti;f.on("mousedown",function(n){n.target.id?(rt=n.target.id,rt===t.id+"_dropdown"&&document.body.addEventListener("click",ri)):rt=n.target.className});t.currentIndex=t.focusFirst?0:null;t.searching=!1;gt=t.$watch("initialValue",function(n){n&&(gt(),ii(n,!0))});t.$watch("fieldRequired",function(n,i){n!==i&&(n?at&&t.currentIndex!==-1?ut(!0):ut(!1):l[t.inputName].$setValidity(wt,!0))});t.$on("angucomplete-alt:clearInput",function(n,i){i&&i!==t.id||(t.searchStr=null,ht(),ut(!1),et())});t.$on("angucomplete-alt:changeInput",function(n,i,r){!i||i!==t.id||ii(r)});t.onFocusHandler=function(){t.focusIn&&t.focusIn();it!==0||t.searchStr&&t.searchStr.length!==0||(t.currentIndex=t.focusFirst?0:t.currentIndex,t.showDropdown=!0,pi())};t.hideResults=function(){rt&&(rt===t.id+"_dropdown"||rt.indexOf("angucomplete")>=0)?rt=null:(pt=u(function(){et();t.$apply(function(){t.searchStr&&t.searchStr.length>0&&ft.val(t.searchStr)})},k),ct(),t.focusOut&&t.focusOut(),t.overrideSuggestions&&t.searchStr&&t.searchStr.length>0&&t.currentIndex===-1&&yt())};t.resetHideResults=function(){pt&&u.cancel(pt)};t.hoverRow=function(n){t.currentIndex=n};t.selectResult=function(n){t.matchClass&&(n.title=vt(n.originalObject),n.description=st(n.originalObject,t.descriptionField));t.searchStr=t.clearSelected?null:n.title;ht(n);et()};t.inputChangeHandler=function(n){return n.length<it?(ct(),et()):n.length===0&&it===0&&(t.searching=!1,pi()),t.inputChanged&&(n=t.inputChanged(n)),n};t.fieldRequiredClass&&t.fieldRequiredClass!==""&&(wt=t.fieldRequiredClass);t.minlength&&t.minlength!==""&&(it=parseInt(t.minlength,10));t.pause||(t.pause=b);t.clearSelected||(t.clearSelected=!1);t.overrideSuggestions||(t.overrideSuggestions=!1);t.fieldRequired&&l&&(t.initialValue?ut(!0):ut(!1));t.inputType=e.type?e.type:"text";t.textSearching=e.textSearching?e.textSearching:g;t.textNoResults=e.textNoResults?e.textNoResults:nt;ni=t.textSearching==="false"?!1:!0;ti=t.textNoResults==="false"?!1:!0;t.maxlength=e.maxlength?parseInt(e.maxlength):w;ft.on("keydown",tr);ft.on("keyup",ki);dt=wi("remoteUrlResponseFormatter");u(function(){var n=getComputedStyle(tt);bt=n.maxHeight&&n.overflowY==="auto"})}var o=40,a=39,s=38,v=37,h=27,c=13,y=9,p=3,w=524288,b=500,k=200,d="autocomplete-required",g="Searching...",nt="No results found",l="/angucomplete-alt/index.html";return f.put(l,'<div class="angucomplete-holder" ng-class="{\'angucomplete-dropdown-visible\': showDropdown}">  <input id="{{id}}_value" name="{{inputName}}" ng-class="{\'angucomplete-input-not-empty\': notEmpty}"\tng-model="searchStr" ng-disabled="disableInput" type="{{inputType}}" placeholder="{{placeholder}}"\tmaxlength="{{maxlength}}" ng-focus="onFocusHandler()" class="{{inputClass}}" ng-focus="resetHideResults()"\tng-blur="hideResults($event)" autocapitalize="off" autocorrect="off" autocomplete="off" ng-change="inputChangeHandler(searchStr)" />  <div id="{{id}}_dropdown" class="angucomplete-dropdown scroll-body-autocomplete scrollbar-dynamic" ng-show="showDropdown" data-jquery-scrollbar>    <div class="angucomplete-searching" ng-show="searching" ng-bind="textSearching"><\/div>    <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"><\/div>    <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}">      <div ng-if="imageField" class="angucomplete-image-holder">        <img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="angucomplete-image"/>        <div ng-if="!result.image && result.image != \'\'" class="angucomplete-image-default"><\/div>      <\/div>      <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"><\/div>      <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}<\/div>      <div ng-if="matchClass && result.description && result.description != \'\'" class="angucomplete-description" ng-bind-html="result.description"><\/div>      <div ng-if="!matchClass && result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}<\/div>    <\/div>  <\/div><\/div>'),{restrict:"EA",require:"^?form",scope:{selectedObject:"=",disableInput:"=",initialValue:"=",localData:"=",remoteUrlRequestFormatter:"=",remoteUrlRequestWithCredentials:"@",remoteUrlResponseFormatter:"=",remoteUrlErrorCallback:"=",remoteApiHandler:"=",id:"@",type:"@",placeholder:"@",remoteUrl:"@",remoteUrlDataField:"@",titleField:"@",descriptionField:"@",imageField:"@",inputClass:"@",pause:"@",searchFields:"@",minlength:"@",matchClass:"@",clearSelected:"@",overrideSuggestions:"@",fieldRequired:"=",fieldRequiredClass:"@",inputChanged:"=",autoMatch:"@",focusOut:"&",focusIn:"&",inputName:"@",focusFirst:"@"},templateUrl:function(n,t){return t.templateUrl||l},compile:function(n){var t=e.startSymbol(),i=e.endSymbol(),r;return t==="{{"&&i==="}}"||(r=n.html().replace(/\{\{/g,t).replace(/\}\}/g,i),n.html(r)),tt}}}])});
/*
//# sourceMappingURL=angucomplete-alt.min.js.map
*/