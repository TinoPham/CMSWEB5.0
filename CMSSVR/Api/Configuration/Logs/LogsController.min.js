define(["require","App","jqdatepicker","nggrid","ng.scrollabletable","ng.gridflexibleheight"],function(n,t){var i=function(n,t,i,r,u,f){function s(n){u.DeleteLog(n).then(function(n){angular.forEach(t.data.Logs,function(i,r){if(i.ID===n.ID){t.data.Logs.splice(r,1);t.totalServerItems>0&&t.totalServerItems--;return}})},function(){})}var e="/Api/shared/ng_grid/HeaderTemplate.html",o=[{field:"ID",displayName:"Log ID",pinnable:!1,resizable:!1,sortable:!0,visible:!1,width:"50px",headerCellTemplate:e},{field:"LogID",displayName:"LogID",pinnable:!1,resizable:!1,sortable:!0,visible:!1,width:"50px",headerCellTemplate:e},{field:"Message",displayName:"Message",pinnable:!1,resizable:!1,sortable:!0,width:"*",headerCellTemplate:e,cellTemplate:"/Api/shared/ng_grid/CellTextTemplate.html"},{field:"MessageData",displayName:"Message Data",pinnable:!1,resizable:!1,sortable:!1,visible:!1,width:"50px",headerCellTemplate:e},{field:"ProgramSet",displayName:"Program-set",pinnable:!1,resizable:!1,sortable:!0,width:"95px",headerCellTemplate:e,cellTemplate:'<div class="ngCellText" ng-class="col.colIndex()"><span  ng-cell-text title="{{ ProgramsetText( row.getProperty(col.field))}}" >{{ ProgramsetText( row.getProperty(col.field))}}<\/span><\/div>'},{field:"DVRDate",displayName:"DVRDate",pinnable:!1,resizable:!1,sortable:!0,width:"130px",cellFilter:"date:'short'",cellTemplate:"/Api/shared/ng_grid/CellDateTime.html",headerCellTemplate:e},{field:"",displayName:"",pinnable:!1,resizable:!1,sortable:!1,width:"70px",cellTemplate:'<div class="ngCellText" style="text-overflow: initial;" ng-class="col.colIndex()"><a id="btnDelete" ng-click="DeleteRow(row.entity)" title="{{resx.str_Delete}}" >{{resx.str_Delete}}<\/a> <\/div>',headerCellTemplate:"/Api/shared/ng_grid/HeaderTemplateDelete.html"}];t.resx={str_DeleteAll:"Delete All",str_Delete:"Delete"};t.data={Logs:[],totalServerItems:0,Programset:[]};t.data.Programset=[{ID:0,Name:"All"},{ID:1,Name:"DVR"},{ID:2,Name:"POS"},{ID:3,Name:"IOPC"},{ID:4,Name:"CA"},{ID:5,Name:"ATM"},{ID:6,Name:"LPR"}];t.filterOptions={filterText:"",useExternalFilter:!0,Programset:t.data.Programset[0],DVRDate:new Date};t.pagingOptions={pageSizes:[25,50,100],pageSize:25,currentPage:1};t.sortOptions={fields:["DVRDate"],directions:["DESC"]};t.gridOptions={data:"data.Logs",columnDefs:o,enablePaging:!0,enablePinning:!0,enableSorting:!0,pagingOptions:t.pagingOptions,filterOptions:t.filterOptions,keepLastSelected:!1,multiSelect:!1,showColumnMenu:!1,showFilter:!1,showGroupPanel:!1,showFooter:!0,sortInfo:t.sortOptions,totalServerItems:"totalServerItems",useExternalSorting:!1,i18n:"en",jqueryUITheme:!0,footerTemplate:"/Api/shared/ng_grid/footerTemplate.html",plugins:[new ngGridFlexibleHeightPlugin],headerRowTemplate:"/Api/shared/ng_grid/headerRowTemplate.html",rowTemplate:"/Api/shared/ng_grid/rowTemplate.html"};t.DeleteRow=function(n){s(n)};t.ProgramsetText=function(n){return t.data.Programset==null||t.data.Programset==undefined||t.data.Programset.length==0?"":((n==null||n==undefined)&&t.data.Programset[0].Name,n>=0&&n<t.data.Programset.length)?t.data.Programset[n].Name:""};t.refresh=function(){setTimeout(function(){var n={Date:i("date")(t.filterOptions.DVRDate,"yyyyMMdd"),Programset:t.filterOptions.Programset.ID>0?t.filterOptions.Programset.ID:null,pageSize:t.pagingOptions.pageSize,pageNumber:t.pagingOptions.currentPage,sortFields:t.sortOptions.fields,sortDirections:t.sortOptions.directions};u.Logs(n).then(function(n){t.data.Logs=n.Logs;t.totalServerItems=n.TotalItem},function(n){r.error(n)},function(n){r.error(n)})},100)};t.DeleteLogs=function(){var n={Date:f.toUTCDate(t.filterOptions.DVRDate),Programset:t.filterOptions.Programset.ID>0?t.filterOptions.Programset.ID:null,pageSize:t.pagingOptions.pageSize,pageNumber:t.pagingOptions.currentPage,sortFields:t.sortOptions.fields,sortDirections:t.sortOptions.directions};u.DeleteLogs(n).then(function(n){t.data.Logs=n.Logs;t.totalServerItems=n.TotalItem},function(n){r.error(n)},function(n){r.error(n)})};t.$watch("pagingOptions",function(n,i){n!==i&&t.refresh()},!0);t.$watch("filterOptions",function(n,i){n!==i&&t.refresh()},!0);t.refresh()};i.$inject=["$rootScope","$scope","$filter","Dialogs","ApiService","Utils"];t.register.controller("LogsController",i)});